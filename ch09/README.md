# 设计模式
## 单例模式


## 不变模式
1. 不变模式的核心思想

在并行开发过程中，为确保数据的一致性和正确性，又必要对对象进行同步，但是同步操作对系统性能有相当的损耗。因此可以使用一种不可改变的对象，依靠其不变形来确保并行操作在没有同步的情况下依旧保持一致性和正确性。

不变模式的使用场景主要包括两个条件：

a. 当对象创建后，其内部状态和数据不再发生任何改变；

b.对象需求被共享、被多线程频繁访问。

2. 不变模式的Java实现

在Java语言中，不变模式的实现很简单，只需要注意一下4点：

a. 去除所有setter方法以及可以修改自身属性的方法；

b. 将所有属性设置为private的，并用final标记，确保其不可修改；

c. 确保没有子类可以继承该类；

d. 有一个可以创建完整对象的构造函数。

下面利用Java代码实现了满足上面4点的不变模式的类：com.lj.ch09.ch0902.Product

3. JDK中不变模式的实例

JDK中不变模式的使用也非常广泛。其中最为典型的是java.lang.String，此外还有所有元数据的包装类，如：

java.lang.Double

java.lang.Integer

java.lang.Boolean
等等。

## 并行模式之生产者-消费者模式
生产者-消费者是一个经典的多线程设计模式，它为多线程间的协作提供了良好的解决方案。在生产者-消费者模式中，通常有两类线程，即若干个生产者线程和若干个消费者线程。生产者线程负责提交用户请求，消费者线程负责具体处理生产者提交的任务。生产者和

消费者之间则通过共享内存缓冲进行通信。 

生产者-消费者模式的核心组件是共享内存缓冲区，它作为生产者消费者间的通信桥梁，避免了两者直接通信，从而将生产者和消费者进行解耦。生产者不需要知道消费者存在，消费者也不需要知道生产者的存在。

同时，由于内存缓冲区的存在,允许生产者和消费者在执行速度上存在时间差，无论谁快谁慢,都可以通过共享缓冲区得到缓解,确保系统稳定允许。

生产者-消费者模式主要角色如下表所示。

角色  作用

生产者     用于提交用户请求,提取用户任务,并装入内存缓冲区

消费者     在内存缓冲区提取并处理任务

内存缓冲区   缓存生产者提交的任务或数据,供消费者使用

任务  生产者向内存缓冲区提交的数据结构

Main    使用生产者和消费者的客户端

实现一个基于生产者-消费者模式的求整数平方的并行程序。

首先，生产者线程的实现如下，它构建PCData对象，并放入BlockingQueue队列中。